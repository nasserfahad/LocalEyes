<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>بطاقة رمضان - إضافة اسم</title>
  <style>
    :root{
      --nameColor:#E8B47A;
      --panel: rgba(255,255,255,.08);
      --border: rgba(255,255,255,.14);
    }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
      background:#062b30;
      color:#fff;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
    }
    .wrap{
      width:min(980px, 100%);
      display:grid;
      gap:14px;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
      backdrop-filter: blur(6px);
    }
    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:end;
      justify-content:space-between;
    }
    .controls .left{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:end;
    }
    label{
      display:block;
      font-size:14px;
      opacity:.9;
      margin-bottom:6px
    }
    input{
      width:min(420px, 100%);
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.22);
      color:#fff;
      outline:none;
    }
    button{
      padding:10px 14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(232,180,122,.16);
      color:#fff;
      cursor:pointer;
      white-space:nowrap;
    }
    button:hover{ background:rgba(232,180,122,.24) }
    .hint{
      margin:10px 0 0;
      font-size:13px;
      opacity:.85;
      line-height:1.7;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }
    canvas{
      width:100%;
      height:auto;
      display:block;
      border-radius:14px;
      border:1px solid var(--border);
      background:#0b3f46;
    }
    a{ color:#fff; text-decoration:underline; }
    code{ background:rgba(0,0,0,.22); padding:2px 6px; border-radius:6px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="controls">
        <div class="left">
          <div>
            <label for="name">اكتب اسمك</label>
            <input id="name" type="text" placeholder="مثال: محمد" />
          </div>
          <button id="renderBtn">عرض بالاسم</button>
          <button id="downloadBtn">حفظ PNG</button>
        </div>

        <div style="opacity:.9;font-size:13px;line-height:1.6;text-align:left" dir="ltr">
          Base image:
          <a href="https://www.genspark.ai/api/files/s/82ZHeJIL" target="_blank" rel="noreferrer">
            https://www.genspark.ai/api/files/s/82ZHeJIL
          </a>
        </div>
      </div>

      <div class="hint">
        الاسم يُكتب <b>بالنص</b> وتحت الدعاء الأبيض مع <b>مسافة شوي</b> وباللون <code>#E8B47A</code>.
        إذا واجهت مشكلة حفظ بسبب CORS، قلّي وأعطيك نسخة تدعم رفع الصورة من جهازك بدل الرابط.
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <canvas id="c" width="1024" height="1024"></canvas>
      </div>

      <div class="card" style="opacity:.92;line-height:1.9">
        <div style="font-weight:700;margin-bottom:8px">تعديل المسافة بسرعة</div>
        <div>مكان الاسم يتحكم فيه المتغير: <code>NAME_Y</code></div>
        <div>قلّل الرقم ↑ الاسم يصعد، زوّد الرقم ↓ الاسم ينزل.</div>
        <hr style="border:0;border-top:1px solid rgba(255,255,255,.14);margin:12px 0">
        <div style="font-weight:700;margin-bottom:8px">المكان الحالي</div>
        <div>مضبوط على “مسافة شوي” تحت الكلام الأبيض.</div>
      </div>
    </div>
  </div>

<script>
  // صورة الخلفية (التصميم الأساسي)
  const BASE_IMAGE_URL = "https://www.genspark.ai/api/files/s/82ZHeJIL"; // [Source](https://www.genspark.ai/api/files/s/82ZHeJIL)

  // إعدادات مكان الاسم
  const NAME_COLOR = "#E8B47A";
  const NAME_FONT  = "600 56px Tahoma, Arial, system-ui";
  const NAME_X_ALIGN = "center";

  // "مسافة شوي" تحت الكلام الأبيض:
  // لو تبغى الاسم أعلى: 805 أو 800
  // لو تبغى الاسم أوطى: 820 أو 830
  const NAME_Y = 810;

  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");
  const nameInput = document.getElementById("name");
  const renderBtn = document.getElementById("renderBtn");
  const downloadBtn = document.getElementById("downloadBtn");

  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = BASE_IMAGE_URL;

  function drawBase() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // خلفية احتياطية
    ctx.fillStyle = "#0b3f46";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // رسم الصورة "Cover" داخل 1024x1024
    const cw = canvas.width, ch = canvas.height;
    const iw = img.naturalWidth || 1024;
    const ih = img.naturalHeight || 1024;

    const scale = Math.max(cw / iw, ch / ih);
    const nw = iw * scale;
    const nh = ih * scale;
    const x = (cw - nw) / 2;
    const y = (ch - nh) / 2;

    ctx.drawImage(img, x, y, nw, nh);
  }

  function drawName(name) {
    const safe = String(name || "").trim().slice(0, 28);
    if (!safe) return;

    ctx.save();
    ctx.direction = "rtl";
    ctx.textAlign = NAME_X_ALIGN;
    ctx.textBaseline = "middle";

    // ظل خفيف للوضوح فوق الخلفية
    ctx.shadowColor = "rgba(0,0,0,0.35)";
    ctx.shadowBlur = 6;

    ctx.fillStyle = NAME_COLOR;
    ctx.font = NAME_FONT;

    const x = canvas.width / 2; // بالنص
    const y = NAME_Y;           // تحت الكلام الأبيض + مسافة شوي

    ctx.fillText(safe, x, y);
    ctx.restore();
  }

  async function render() {
    if (!img.complete) await new Promise(res => img.onload = res);
    drawBase();
    drawName(nameInput.value);
  }

  function downloadPNG() {
    // ملاحظة: لو المصدر ما يسمح CORS ممكن يطلع خطأ (tainted canvas)
    const a = document.createElement("a");
    a.download = "ramadan-name.png";
    a.href = canvas.toDataURL("image/png");
    a.click();
  }

  renderBtn.addEventListener("click", render);

  downloadBtn.addEventListener("click", () => {
    try {
      downloadPNG();
    } catch (e) {
      alert("تعذر حفظ الصورة بسبب قيود CORS من مصدر الصورة. قلّي وأجهز لك نسخة ترفع الصورة من جهازك وتشتغل 100%.");
      console.error(e);
    }
  });

  img.onload = render;
</script>
</body>
</html>
